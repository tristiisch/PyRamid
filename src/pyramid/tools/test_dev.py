import asyncio
from logging import Logger
import threading

from connector.deezer.search import DeezerSearch
from data.functional.git_info import GitInfo
from connector.deezer.downloader import DeezerDownloader
from tools.configuration.configuration import Configuration
from connector.spotify.search import SpotifySearch


class TestDev:
	def __init__(self, config: Configuration, logger: Logger):
		self._config = config
		self.logger = logger

	async def test_spotify(self):
		spotify_search = SpotifySearch(
			self._config.general__limit_tracks,
			self._config.spotify__client_id,
			self._config.spotify__client_secret,
		)
		res = await spotify_search.get_track_by_id("5cpMslbJb6KxMGcpfZQB2Q")
		if res is None:
			return
		self.logger.info(res)

	async def test_deezer(self, input):
		deezer_search = DeezerSearch(self._config.general__limit_tracks)
		res = await deezer_search.search_tracks(input, limit=10)
		if res is None:
			return
		for track in res:
			self.logger.info(track)

	def test_git(self):
		t = GitInfo()
		t.get()
		t.save()

		t2 = GitInfo.read()
		if t2:
			self.logger.info(vars(t2))

	async def test_dl(self):
		def process_list_part(part):
			asyncio.run(self._test_dl_list(part))

		list = [
			456075992,
			456076002,
			456076012,
			456076022,
			456076032,
			1996104197,
			456076052,
			456076062,
			456076072,
			456076082,
			456076092,
			456076102,
			456076112,
			456076122,
			456076132,
			456076142,
			456076152,
			140398621,
			140398623,
			140398625,
			140398627,
			140398629,
			140398631,
			140398635,
			140398639,
			140398645,
			140398647,
			140398649,
			140398651,
			140398653,
			140398657,
			140398663,
			140398667,
			140398669,
			130118443,
			130118445,
			130118447,
			130118449,
			130118451,
			130118453,
			130118455,
			130118457,
			130118459,
			130118461,
			130118463,
			130118451,
			130118467,
			130118469,
			130118471,
			130118473,
			130118475,
			130118477,
			130118479,
			130118481,
			130118483,
			130118485,
			130118487,
			130118489,
			130118491,
			130118493,
			130118495,
			130118497,
			130118499,
			130118501,
			130118503,
			130118505,
			130118507,
			130118509,
			130118511,
			130118513,
			130118515,
			130118517,
			130118519,
			130118521,
			130118523,
			130118525,
			1427139322,
			1427139332,
			1427139342,
			1427139352,
			1427139362,
			1427139372,
			1427139382,
			3466616,
			1427139392,
			1427139402,
			1427139412,
			1427139422,
			88845471,
			88845473,
			88845475,
			88845477,
			88845479,
			88845481,
			88845483,
			88845485,
			88845487,
			88845489,
			88845491,
			88845493,
			88845495,
			1435250522,
			1432728632,
			1436422972,
			1432729272,
			453205212,
			453205222,
			453205232,
			453205242,
			453205252,
			453205262,
			453205272,
			453205282,
			453205292,
			453205302,
			453205312,
			453205322,
			453205332,
			453205342,
			453205352,
			402865082,
			402865092,
			402865102,
			402865112,
			402865122,
			402865132,
			402865142,
			402865152,
			402865162,
			402865172,
			402865182,
			402865192,
			140761589,
			402865212,
			402865222,
			140761563,
			140761565,
			140761567,
			140761569,
			140761571,
			140761573,
			140761575,
			140761577,
			140761579,
			140761581,
			140761583,
			140761585,
			140761587,
			140761589,
			67974549,
			67974550,
			67974551,
			67974552,
			67974553,
			67974554,
			67974555,
			67974556,
			67974557,
			67974558,
			67974559,
			67974560,
			67974561,
			1097553212,
			67974563,
			67974564,
			1905116307,
			1648765502,
			1648765532,
			1648765522,
			1905116367,
			1648765562,
			1648765542,
			1648765572,
			936960742,
			2077340227,
			2143710557,
			1278138652,
			2294531165,
			2045327247,
			379692391,
			405077902,
			70229453,
			2561290962,
			145262374,
			393491352,
			2561471692,
			1888293827,
			676242592,
			359256871,
			373954451,
			378796211,
			518888022,
			362777071,
			362777081,
			362777091,
			362777101,
			362777111,
			362777121,
			362777131,
			362777141,
			362777151,
			362777161,
			362777171,
			362777181,
			362777191,
			362777201,
			362777211,
			135010088,
			135010090,
			135010092,
			135010094,
			135010096,
			135010098,
			135010100,
			2325243435,
			135010104,
			135010106,
			550581152,
			516227762,
			516227772,
			516227782,
			516227792,
			516227802,
			516227812,
			516227822,
			516227832,
			516227842,
			516227852,
			516227862,
			123598936,
			145214554,
			423178852,
			423178732,
			136663726,
			145214544,
			354197371,
			123598960,
			423178712,
			145214550,
			354197221,
			423178692,
			423178702,
			423178812,
			136196530,
			423178752,
			423178792,
			423178822,
			423178722,
			423178762,
			423178862,
			423178802,
			354197331,
			354197301,
			423178742,
			354197381,
			354197251,
			354197321,
			423178772,
			354197291,
			122867714,
			354197341,
			354197241,
			423178782,
			354197361,
			354197271,
			123598954,
			122867832,
			136663738,
			123598942,
			122867844,
			123598956,
			423178832,
			136663734,
			123598940,
			123598938,
			136663728,
			122867712,
			423178842,
			136663724,
			122867836,
			136663720,
			123598934,
			122867846,
			122867716,
			136663730,
			123598944,
			122867720,
			136663732,
			123598958,
			411066142,
			123598952,
			123598946,
			122867834,
			122867838,
			122867708,
			122867842,
			136663736,
			122867840,
			122867850,
			136663722,
			122867710,
			122867722,
			122867706,
			122867718,
			122867848,
			122867852,
			122867726,
			546289362,
			95683306,
			2519161201,
			481510442,
			2519161181,
			393491352,
			379692391,
			145262374,
			359256871,
			98890726,
			119498020,
			489013092,
			405077902,
			2519161151,
			511048252,
			2519161141,
			98890712,
			98890730,
			2519161231,
			98890710,
			2519161211,
			2519161161,
			2519161171,
			2519161251,
			2519161191,
			98890734,
			98890718,
			2519161131,
			98890724,
			2519161221,
			2519161241,
			98890714,
			64603630,
			98890738,
			482070322,
			98890728,
			98890716,
			6598171,
			98890720,
			17011727,
			65037514,
			98890736,
			98890722,
			65037516,
			98890732,
			65037513,
			17011736,
			65037512,
			65037509,
			65037517,
			17011730,
			17011723,
			17011726,
			17011733,
			65037522,
			124617124,
			65037520,
			17011724,
			17011725,
			65037518,
			65037521,
			17011729,
			17011737,
			65037523,
			65037519,
			17011728,
			17011734,
			17011731,
			17011735,
			72111022,
			17011732,
			2577851212,
			122808672,
			489013002,
			378743701,
			122462562,
			142696126,
			137366846,
			366033331,
			357576541,
			143447586,
			414750032,
			414750002,
			414750042,
			490497092,
			452856262,
			414750012,
			141456573,
			414750022,
			428974682,
			428974592,
			428974522,
			84310989,
			145501466,
			428974552,
			428974622,
			115066968,
			145501460,
			428974642,
			145501488,
			428974602,
			84310967,
			428974532,
			428974512,
			428974562,
			145501458,
			145501486,
			145501454,
			428974612,
			428974572,
			428974632,
			428974542,
			145501480,
			145501474,
			145501468,
			84310991,
			145501476,
			84310973,
			84310971,
			84310977,
			115066964,
			69236318,
			84310969,
			84310985,
			115066978,
			145501492,
			84310979,
			428974672,
			145501462,
			115066974,
			145501456,
			84310993,
			115066984,
			84310995,
			101346068,
			115066990,
			69236316,
			101346060,
			428974652,
			101346080,
			84310975,
			145501464,
			67931882,
			145501472,
			67931888,
			69236314,
			145501484,
			62891413,
			67931878,
			101346074,
			69236315,
			62891408,
			115066994,
			119498056,
			145501482,
			62891412,
			84310983,
			62891423,
			145501478,
			101346064,
			101346084,
			69236317,
			101346072,
			101346070,
			115067004,
			101346082,
			62891415,
			84310981,
			101346078,
			115067000,
			115067016,
			101346066,
			67931884,
			115067026,
			115067020,
			101346062,
			115067010,
			62891421,
			62891410,
			69236323,
			69236320,
			84310987,
			101346076,
			62891418,
			62891414,
			62891409,
			62891425,
			408868822,
			408868832,
			538112872,
			408868852,
			408868862,
			408868872,
			408868882,
			408868892,
			408868902,
			408868912,
			408868922,
			408868932,
			408868942,
			408868952,
			538112992,
			408868972,
			408868832,
			538113022,
			522622402,
			522622282,
			522622322,
			522622252,
			522622272,
			522622342,
			135438506,
			522622292,
			522622392,
			522622302,
			522622362,
			522622312,
			522622262,
			522622382,
			522622352,
			448255802,
			522622332,
			516244542,
			522622372,
			135438524,
			135438508,
			382807321,
			91581646,
			135438504,
			135438522,
			135438518,
			135438510,
			472155342,
			135438502,
			96149650,
			135438500,
			135438516,
			96149638,
			135438512,
			135438514,
			135438526,
			135438520,
			96149644,
			104822148,
			96149632,
			96149640,
			104822146,
			131071770,
			96149658,
			104822164,
			131383198,
			96149636,
			96149660,
			96149652,
			104822160,
			96149634,
			96149642,
			131071778,
			104822152,
			96149654,
			96149646,
			122462560,
			131071782,
			104822150,
			96149656,
			131071774,
			515845362,
			104822154,
			104822162,
			104822156,
			131071768,
			66475897,
			66475899,
			3065746,
			8930109,
			8930107,
			8930093,
			8930091,
			66475900,
			8930096,
			66475905,
			8930095,
			66475896,
			8930087,
			8930102,
			8930105,
			66475903,
			8930103,
			8930108,
			8930086,
			66475901,
			66475898,
			8930092,
			66475908,
			66475907,
			18232451,
			8930098,
			8930088,
			8930097,
			8930089,
			8930099,
			66475910,
			66475904,
			66475909,
			2376189565,
			511508682,
			511508642,
			447344592,
			511508652,
			2383642605,
			511508662,
			507793042,
			2383642555,
			2383642525,
			2376189545,
			511508672,
			2376189555,
			2383642535,
			2383642485,
			2383642495,
			1355970042,
			2383642515,
			2383642545,
			2383642475,
			2376189505,
			1355970052,
			1355970132,
			2383642455,
			1355970072,
			2376189575,
			2383642575,
			1355970062,
			2383642505,
			2383642465,
			2376189515,
			2383642565,
			1355970122,
			1355970092,
			1355970082,
			2376189525,
			1355970112,
			1355970102,
			2376189535,
			2383642585,
			2376189585,
			2367444985,
			2383642595,
			2376189565,
			366120211,
			366112941,
			422194362,
			531618011,
			143137188,
			489013082,
			520021872,
			126238251,
			511048312,
			378743641,
			124921670,
			124921654,
			130945336,
			130113903,
			119553044,
			124923898,
			126238249,
			132404424,
			136196506,
			432048322,
			5473445,
			18232394,
			131071776,
			131070836,
			6041228,
			3267404,
			524447,
			457553372,
			14257348,
			36109601,
			6190094,
			2400439695,
			1101732,
			498536722,
			498536732,
			498536742,
			498536752,
			498536762,
		]

		parts = 7
		list_parts = [
			list[i : i + len(list) // parts] for i in range(0, len(list), len(list) // parts)
		]
		threads = []
		for part in list_parts:
			thread = threading.Thread(target=process_list_part, args=(part,))
			threads.append(thread)
			thread.start()
		self.logger.info("All threads are started.")
		for thread in threads:
			thread.join()
		self.logger.info("All threads have finished.")

	async def _test_dl_list(self, list):
		for track_id in list:
			dz = DeezerDownloader(self._config.deezer__arl, "./songs")
			await dz.dl_track_by_id(track_id)
